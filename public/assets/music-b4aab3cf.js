import{_ as T,r as q,o as a,c as p,a as _,w as C,p as R,b as A,d as l,u as F,e as w,f as m,g as V,h as o,F as P,t as k,i as Y,n as D,j as Z,k as K,l as ee,m as z,q as te,s as N,v as J,K as se,x as le,y as ne}from"./index-de120711.js";import{I as b}from"./icon-3000e80b.js";const oe={},B=u=>(R("data-v-ceed5319"),u=u(),A(),u),ie={class:"music-btn"},re=B(()=>l("span",null,"正在播放",-1)),ce=B(()=>l("span",null,"推荐",-1)),ae=B(()=>l("span",null,"搜索",-1)),ue=B(()=>l("span",null,"我的歌单",-1)),de=B(()=>l("span",null,"我听过的",-1));function _e(u,d){const e=q("router-link");return a(),p("div",ie,[_(e,{to:"/music/playlist"},{default:C(()=>[re]),_:1}),_(e,{to:"/music/toplist"},{default:C(()=>[ce]),_:1}),_(e,{to:"/music/search"},{default:C(()=>[ae]),_:1}),_(e,{to:"/music/userlist"},{default:C(()=>[ue]),_:1}),_(e,{to:"/music/historylist"},{default:C(()=>[de]),_:1})])}const pe=T(oe,[["render",_e],["__scopeId","data-v-ceed5319"]]),ve=""+new URL("player_cover-75234800.png",import.meta.url).href;const me={class:"music-info"},fe=["src"],ye={key:1,src:ve,alt:""},he={key:1},ge={class:"lyric-items"},xe={key:0},$e={key:1},ke={key:3},Ie={__name:"lyric",setup(u){const d=F();let e=w(()=>d.lyricIndex),s=w(()=>d.currentMusic),c=w(()=>d.lyric),n=w(()=>d.nolyric),r=m(null);V(()=>{if(y.value)return;let f,S=d.lyricIndex;f=Array.from(document.querySelectorAll(".lyric-item")).slice(0,S).reduce((i,x)=>i+x.clientHeight,0),r.value.scrollTo({top:f,behavior:"smooth"})},{flush:"post"});function $(f){d.audioEle.currentTime=f.time}let y=m(!1),h;function M(){y.value=!0,clearTimeout(h),h=setTimeout(()=>{y.value=!1},2e3)}return(f,S)=>(a(),p(P,null,[l("dl",me,[l("dt",null,[o(s).id?(a(),p("img",{key:0,src:`${o(s).image}?300y300`},null,8,fe)):(a(),p("img",ye))]),o(s).id?(a(),p(P,{key:0},[l("dd",null,"歌曲名："+k(o(s).name),1),l("dd",null,"歌手名："+k(o(s).singer),1),l("dd",null,"专辑名："+k(o(s).album),1)],64)):(a(),p("dd",he,"Player在线音乐播放器"))]),l("div",{class:"lyric",ref_key:"lyricREF",ref:r,onScroll:M},[l("div",ge,[o(s).id?o(n)?(a(),p("p",$e,"暂无歌词")):o(c).length>0?(a(!0),p(P,{key:2},Y(o(c),(g,i)=>(a(),p("span",{key:i,class:D(["lyric-item",{active:o(e)===i}])},[Z(k(g.text)+" ",1),_(b,{type:"play",size:15,title:"从当前开始",onClick:x=>$(g)},null,8,["onClick"])],2))),128)):(a(),p("p",ke,"歌词加载失败！")):(a(),p("p",xe,"还未选择音乐哦！"))])],544)],64))}},be=T(Ie,[["__scopeId","data-v-1fcefd91"]]);const we={__name:"progress",props:{percent:{type:Number,default:0}},emits:["changePercent"],setup(u,{emit:d}){const e=u,s=F(),c=m(null),n=m(null),r=m(null);V(()=>{let i=e.percent;n.value.style.width=c.value.clientWidth*i+"px",r.value.style.left=c.value.clientWidth*i+"px"},{flush:"post"}),K(()=>{$()});function $(){document.addEventListener("mousemove",f),document.addEventListener("mouseup",S)}function y(i){if(!s.currentMusic.id)return;let x=c.value.getBoundingClientRect(),I=Math.min(Math.max(i.clientX-x.left,0),x.width);n.value.style.width=I+"px",r.value.style.left=I+"px"}let h=m(!1);function M(i){y(i),s.isMove=!0,h.value=!0}function f(i){h.value&&y(i)}function S(i){h.value&&(h.value=!1,s.isMove=!1,g())}function g(){const i=n.value.clientWidth/c.value.clientWidth;d("changePercent",i.toFixed(3))}return(i,x)=>(a(),p("div",{class:"progress",onMousedown:M},[l("div",{class:"progress-bar",ref_key:"progress_bar",ref:c},null,512),l("div",{class:"progress-current",ref_key:"progress_current",ref:n},null,512),l("div",{class:"progress-dot",ref_key:"progress_dot",ref:r},null,512)],32))}},O=T(we,[["__scopeId","data-v-5047f323"]]);const U=u=>(R("data-v-6428bdb8"),u=u(),A(),u),Se={class:"bar-btns"},Ee={class:"progress-bar"},Ce={class:"music-info"},Me=U(()=>l("span",null,"您似乎还没有选择音乐哦！",-1)),Le=U(()=>l("span",null,"00:00/00:00",-1)),Pe={class:"volume"},Te={class:"volume-progress"},Be={__name:"bar",setup(u){const d=ee(),e=F();let s=w(()=>e.currentMusic),c=w(()=>e.audioEle),n=m("order"),r=m("切换为：单曲循环");function $(){let t="";switch(n.value){case"order":n.value="loop",t="单曲循环",r.value="切换为：随机播放";break;case"loop":n.value="shuffle",t="随机播放",r.value="切换为：顺序播放";break;case"shuffle":n.value="order",t="顺序播放",r.value="切换为：单曲循环";break}window.$tip(`已更改为：${t}`)}function y(t){if(!s.value.id){window.$tip("需要先选择歌曲哦！");return}c.value.currentTime=Math.floor(s.value.duration*t),i.value=c.value.currentTime}function h(){if(!s.value.id){window.$tip("需要先选择歌曲哦！");return}e.getPlayList.length===1||e.currentIndex-1===0?e.setCurrentIndex(e.getPlayList.length-1):(e.setCurrentIndex(e.currentIndex-1),e.audioEle.src=e.currentMusic.url,e.audioEle.play())}function M(){if(!s.value.id){window.$tip("需要先选择歌曲哦！");return}e.playing?e.audioEle.pause():e.audioEle.play(),e.setPlaying(!e.playing)}function f(){if(!s.value.id){window.$tip("需要先选择歌曲哦！");return}e.getPlayList.length===1||e.getPlayList.length-1===e.currentIndex?e.setCurrentIndex(0):(e.setCurrentIndex(S(e.currentIndex)),e.audioEle.src=e.currentMusic.url,e.audioEle.play())}function S(t){return n.value==="order"?t+1:n.value==="loop"?t:Math.floor(Math.random()*e.getPlayList.length)}let g=m(0);z(s,t=>{i.value=0;let v=JSON.parse(localStorage.getItem("historyList"))||[];v.some(Q=>Q.id===t.id)||(v.unshift(t),localStorage.setItem("historyList",JSON.stringify(v)))});let i=m(0);z(i,()=>{let t=0;for(let v=0;v<e.lyric.length;v++)c.value.currentTime>=e.lyric[v].time&&(t=v);e.lyricIndex=t}),K(()=>{c.value.addEventListener("timeupdate",()=>{e.isMove||(g.value=Number.parseFloat((c.value.currentTime/s.value.duration).toFixed(3)),i.value=c.value.currentTime,g.value===1&&f())}),e.audioEle.addEventListener("error",v=>{window.$tip("当前歌曲无法播放，已自动切换到下一首");let L=JSON.parse(localStorage.getItem("historyList"))||[];L.shift(),localStorage.setItem("historyList",JSON.stringify(L)),f()});let t=parseFloat(localStorage.getItem("volume"));I.value=t||1,e.audioEle.volume=t||1});function x(t){let v=Math.floor(t/60).toString().padStart(2,0),L=Math.floor(t%60).toString().padStart(2,0);return`${v}:${L}`}let I=m(1),E=m("voice");function H(){if(E.value==="voice")E.value="voice-close",e.audioEle.volume=0,I.value=0;else{E.value="voice";let t=parseFloat(localStorage.getItem("volume"));e.audioEle.volume=t||1,I.value=t||1}}function X(t){localStorage.setItem("volume",t),e.audioEle.volume=t,t==0?E.value="voice-close":E.value="voice"}function G(){if(!s.value.id){window.$tip("还没有播放歌曲哦！");return}d.push({name:"comment",params:{id:s.value.id}})}return(t,v)=>(a(),p("div",{class:D(["bar",{disable:!o(s).id}])},[l("div",Se,[_(b,{type:"previous",size:36,onClick:h}),_(b,{type:o(e).playing?"pause":"play",size:55,onClick:M},null,8,["type"]),_(b,{type:"next",size:36,onClick:f})]),l("div",Ee,[l("div",Ce,[o(s).id?(a(),p(P,{key:0},[l("span",null,k(o(s).name)+"-"+k(o(s).singer),1),l("span",null,k(x(o(i)))+"/"+k(x(o(s).duration)),1)],64)):(a(),p(P,{key:1},[Me,Le],64))]),_(O,{percent:o(g),onChangePercent:y},null,8,["percent"])]),_(b,{type:o(n),title:o(r),size:24,onClick:$},null,8,["type","title"]),_(b,{type:"comments",size:24,onClick:G}),l("div",Pe,[_(b,{type:o(E),size:24,onClick:H},null,8,["type"]),l("div",Te,[_(O,{percent:o(I),onChangePercent:X},null,8,["percent"])])])],2))}},Ne=T(Be,[["__scopeId","data-v-6428bdb8"]]),W=/\[(\d{2,}):(\d{2})(?:\.(\d{2,3}))?]/g;function Fe(u){const d=u.split(`
`),e=[];for(let s=0;s<d.length;s++){const c=d[s],n=W.exec(c);if(!n)continue;const r=c.replace(W,"").trim();r&&e.push({time:(n[1]*6e4+n[2]*1e3+(n[3]||0)*1)/1e3,text:r})}return e}const j=u=>(R("data-v-7515ced7"),u=u(),A(),u),ze={class:"music"},Re={class:"music-content"},Ae={class:"music-left"},Je={class:"music-right"},Oe={class:"music-bar"},We=j(()=>l("div",{class:"bg"},null,-1)),qe=j(()=>l("div",{class:"mask"},null,-1)),Ve={__name:"music",setup(u){const d=te(),e=F(),s=w(()=>e.currentMusic);function c(n){ne(n).then(r=>{r.lrc&&r.lrc.lyric?(e.nolyric=!1,e.lyric=Fe(r.lrc.lyric)):e.nolyric=!0})}return z(s,n=>{if(c(n.id),!n.image)return;let r=`url(${n.image}?300y300)`;document.querySelector(".bg").style.backgroundImage=r}),(n,r)=>{const $=q("router-view");return a(),p("div",ze,[l("div",Re,[l("div",Ae,[_(pe),o(d).meta.keepAlive?(a(),N($,{key:0},{default:C(({Component:y})=>[(a(),N(se,null,[(a(),N(le(y)))],1024))]),_:1})):J("",!0),o(d).meta.keepAlive?J("",!0):(a(),N($,{key:1}))]),l("div",Je,[_(be)])]),l("div",Oe,[_(Ne)]),We,qe])}}},Ue=T(Ve,[["__scopeId","data-v-7515ced7"]]);export{Ue as default};
